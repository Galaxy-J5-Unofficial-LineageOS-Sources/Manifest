From 40c854807c8870e0f3ffd7837e2efcb4594e8186 Mon Sep 17 00:00:00 2001
From: daviiid99 <daviiideveloper@gmail.com>
Date: Thu, 25 Aug 2022 12:59:04 +0200
Subject: [PATCH] Revert 'Fix process group of webview zygote'

---
 .../java/com/android/server/am/ProcessList.java | 17 +++++++----------
 1 file changed, 7 insertions(+), 10 deletions(-)

diff --git a/services/core/java/com/android/server/am/ProcessList.java b/services/core/java/com/android/server/am/ProcessList.java
index 92a8dcd2ba8f..cacaa891c02a 100644
--- a/services/core/java/com/android/server/am/ProcessList.java
+++ b/services/core/java/com/android/server/am/ProcessList.java
@@ -2275,7 +2275,6 @@ public final class ProcessList {
             }
 
             final Process.ProcessStartResult startResult;
-            boolean regularZygote = false;
             if (hostingRecord.usesWebviewZygote()) {
                 startResult = startWebView(entryPoint,
                         app.processName, uid, uid, gids, runtimeFlags, mountExternal,
@@ -2295,8 +2294,14 @@ public final class ProcessList {
                         app.getDisabledCompatChanges(), pkgDataInfoMap, allowlistedAppDataInfoMap,
                         false, false,
                         new String[]{PROC_START_SEQ_IDENT + app.getStartSeq()});
+
+                if (Process.createProcessGroup(uid, startResult.pid) < 0) {	
+                    Slog.e(ActivityManagerService.TAG, "Unable to create process group for "	
+                            + app.processName + " (" + startResult.pid + ")");	
+                }
+
             } else {
-                regularZygote = true;
+
                 startResult = Process.start(entryPoint,
                         app.processName, uid, uid, gids, runtimeFlags, mountExternal,
                         app.info.targetSdkVersion, seInfo, requiredAbi, instructionSet,
@@ -2306,14 +2311,6 @@ public final class ProcessList {
                         new String[]{PROC_START_SEQ_IDENT + app.getStartSeq()});
             }
 
-            if (!regularZygote) {
-                // webview and app zygote don't have the permission to create the nodes
-                if (Process.createProcessGroup(uid, startResult.pid) < 0) {
-                    Slog.e(ActivityManagerService.TAG, "Unable to create process group for "
-                            + app.processName + " (" + startResult.pid + ")");
-                }
-            }
-
             // This runs after Process.start() as this method may block app process starting time
             // if dir is not cached. Running this method after Process.start() can make it
             // cache the dir asynchronously, so zygote can use it without waiting for it.
-- 
2.34.1

